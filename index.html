<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Topic News Aggregator</title>
<meta name="theme-color" content="#0b1220">
<link rel="manifest" href="./manifest.webmanifest">
<link rel="icon" href="./icons/icon-192.png">
<style>
:root{
  --bg1:#19a0ff; --bg2:#7b2cff; --text:#f3f4f6; --muted:#94a3b8;
  --chip:#0b1526; --chipBorder:#2b364a; --panel:#0e1628; --white:#ffffff;
  --btn:#10b981; --btn2:#1f2937;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  background: radial-gradient(1200px 700px at 10% 0%, var(--bg1), transparent 60%),
              linear-gradient(135deg, #09111e, #1a0931 70%, #0a0d16);
  color: var(--text);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}
.container{max-width:1100px;margin:0 auto;padding:16px}
.topbar{display:flex;justify-content:space-between;align-items:center;gap:10px}
.title{font-size:28px;font-weight:800;text-align:center;margin:16px 0}
.badges{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.badge{
  background:var(--chip);border:1px solid var(--chipBorder);color:#d1e4ff;
  border-radius:999px;padding:6px 10px;font-size:12px;display:inline-flex;gap:6px;align-items:center;
}
.menu-btn{
  display:inline-flex;align-items:center;justify-content:center;
  width:36px;height:36px;border-radius:10px;border:1px solid var(--chipBorder);background:var(--chip);
}
.right-controls{display:flex;align-items:center;gap:10px}
.select{border:1px solid var(--chipBorder);background:var(--chip);color:#e5e7eb;border-radius:10px;padding:8px 10px}
.search-wrap{margin:14px 0}
.search-row{display:flex;gap:10px;align-items:center}
.search-input{
  flex:1;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.95);color:#111827;
  padding:16px 18px;border-radius:16px;font-size:16px;outline:none;
}
.btn{border:none;border-radius:12px;padding:12px 16px;font-weight:700;color:#071016;cursor:pointer}
.btn.primary{background:#22d3ee}
.btn.secondary{background:transparent;border:1px solid var(--chipBorder);color:#d1d5db}
.panel{
  background: rgba(255,255,255,.9); backdrop-filter: blur(2px);
  border:1px solid rgba(0,0,0,.06); border-radius:16px; padding:18px; color:#334155;
}
.hint{color:#6b7280;text-align:center}
.grid{display:grid;gap:12px;margin:16px 0;grid-template-columns:repeat(auto-fill,minmax(280px,1fr))}
.card{background:var(--panel);border:1px solid #1f2937;border-radius:16px;padding:12px;display:flex;flex-direction:column;gap:8px;color:#e5e7eb}
.card h3{margin:0;color:#fff;font-size:16px;line-height:1.3}
.card .meta{font-size:12px;color:#9ca3af}
.card a{color:#93c5fd}
.count{margin-top:12px;color:#cbd5e1}
footer{padding:20px 0;color:#94a3b8;text-align:center}
@media (max-width: 740px){
  .title{font-size:22px}
  .search-input{font-size:16px}
  .right-controls{position:fixed;top:12px;right:12px;z-index:5}
}
</style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <button class="menu-btn" id="menu" title="Menu">‚ò∞</button>
      <div class="title">Topic News Aggregator</div>
      <div class="right-controls">
        <label style="font-size:12px;color:#cbd5e1;margin-right:6px">Sort</label>
        <select id="sort" class="select">
          <option value="relevance">Relevance</option>
          <option value="source">Source</option>
          <option value="title">Title</option>
        </select>
      </div>
    </div>

    <div class="badges" id="badges">
      <span class="badge" id="scanned">‚óè Sources scanned: 0/0</span>
      <span class="badge">üáÆüá± IL: 7 + GNews</span>
      <span class="badge">GNews EN</span>
    </div>

    <div class="search-wrap">
      <div class="search-row">
        <input id="q" class="search-input" placeholder="Enter a topic‚Ä¶" autocomplete="on">
        <button id="go" class="btn primary">Search</button>
        <button id="clear" class="btn secondary">Clear</button>
      </div>
    </div>

    <div class="panel">
      <div class="hint" id="hint">Search for a topic to see results.</div>
      <div class="count" id="count"></div>
      <section id="results" class="grid" aria-live="polite"></section>
    </div>

    <footer>UI matched to your screenshot ‚Ä¢ Desktop & Mobile ready</footer>
  </div>

<script>
try{ if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js'); } }catch(e){}

const SOURCES = [
  { name: "Google News (IL)", host: "news.google.com", type: "search", lang: "he-IL" },
  { name: "Ynet", host: "ynet.co.il", type: "site" },
  { name: "Walla", host: "walla.co.il", type: "site" },
  { name: "N12", host: "mako.co.il", type: "site" },
  { name: "Kan News", host: "kan.org.il", type: "site" },
  { name: "Maariv", host: "maariv.co.il", type: "site" },
  { name: "Calcalist", host: "calcalist.co.il", type: "site" },
  { name: "TheMarker", host: "themarker.com", type: "site" },
  { name: "Globes", host: "globes.co.il", type: "site" },
  { name: "Jerusalem Post", host: "jpost.com", type: "site" },
  { name: "Times of Israel", host: "timesofisrael.com", type: "site" },
  { name: "Israel Hayom", host: "israelhayom.co.il", type: "site" },
  { name: "i24NEWS", host: "i24news.tv", type: "site" }
];

const $ = (s, el=document)=> el.querySelector(s);
const create = (t, props={}) => Object.assign(document.createElement(t), props);

function updateScanned(done, total){
  $("#scanned").textContent = `‚óè Sources scanned: ${done}/${total}`;
}

function buildSearchUrl(source, q){
  const encoded = encodeURIComponent(q);
  if (source.type === "search" && source.host === "news.google.com") {
    return `https://news.google.com/search?q=${encoded}&hl=he-IL&gl=IL&ceid=IL:he`;
  }
  return `https://www.bing.com/search?q=site%3A${encodeURIComponent(source.host)}+${encoded}`;
}

async function fetchThroughReader(url){
  const reader = "https://r.jina.ai/http/";
  const u = url.startsWith("http") ? url : ("https://" + url);
  const final = reader + u.replace(/^https?:\/\//,"");
  const res = await fetch(final, { mode: "cors" });
  if (!res.ok) throw new Error("Fetch failed: " + res.status);
  return await res.text();
}

function parseBingLinks(html, host){
  const out = [];
  const rx = /<li class=\"b_algo\">[\s\S]*?<h2><a href=\"([^\"]+)\"[^>]*>([\s\S]*?)<\/a><\/h2>[\s\S]*?(?:<p>([\s\S]*?)<\/p>)?/g;
  let m;
  while ((m = rx.exec(html))) {
    const href = m[1]; if (!href || !href.includes(host)) continue;
    const title = (m[2]||"").replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim();
    const snippet = (m[3]||"").replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim();
    out.push({ href, title, snippet, host });
  }
  return out;
}

function renderResults(items){
  const grid = $("#results"); grid.innerHTML = "";
  $("#count").textContent = items.length ? (items.length + " results") : "";
  if (!items.length) return;
  items.forEach(it => {
    const card = create("article", { className: "card" });
    const h3 = create("h3"); h3.textContent = it.title || it.href;
    const meta = create("div", { className: "meta" }); meta.textContent = it.host;
    const p = create("p"); p.textContent = it.snippet || "";
    const a = create("a", { href: it.href, target: "_blank", rel: "noopener", textContent: "Open source" });
    card.append(h3, meta, p, a);
    grid.appendChild(card);
  });
}

function sortItems(items, how){
  if (how === "source") items.sort((a,b)=> a.host.localeCompare(b.host));
  if (how === "title") items.sort((a,b)=> (a.title||"").localeCompare(b.title||""));
  return items;
}

async function run(q){
  $("#hint").textContent = "Searching‚Ä¶";
  $("#results").innerHTML = "";
  $("#count").textContent = "";
  updateScanned(0, SOURCES.length);
  const all = [];
  let done = 0;
  for (const src of SOURCES) {
    try {
      const url = buildSearchUrl(src, q);
      if (src.host === "news.google.com") {
        all.push({ href: url, title: "Google News results for: " + q, snippet: "Open to view aggregated coverage", host: src.host });
      } else {
        const html = await fetchThroughReader(url);
        const items = parseBingLinks(html, src.host);
        all.push(...items.slice(0,6));
      }
    } catch (e) {
      all.push({ href: buildSearchUrl(src, q), title: `[${src.name}] Open results (blocked)`, snippet: String(e.message||e), host: src.host });
    } finally {
      done++; updateScanned(done, SOURCES.length);
    }
  }
  const seen = new Set(), uniq = [];
  for (const it of all) if (!seen.has(it.href)) { seen.add(it.href); uniq.push(it); }
  const how = $("#sort").value;
  renderResults(sortItems(uniq, how));
  $("#hint").textContent = uniq.length ? "" : "No results.";
  if (location) history.replaceState(null, "", "#q=" + encodeURIComponent(q));
}

const input = $("#q"); const btn = $("#go"); const clr = $("#clear");
btn.onclick = ()=>{ const q = input.value.trim(); if(q) run(q); };
input.addEventListener("keydown", e=>{ if(e.key === "Enter"){ const q = input.value.trim(); if(q) run(q);} });
clr.onclick = ()=>{ input.value = ""; $("#results").innerHTML=""; $("#count").textContent=""; $("#hint").textContent = "Search for a topic to see results."; updateScanned(0,0); };

if (location.hash.startsWith("#q=")) {
  const q = decodeURIComponent(location.hash.slice(3)); input.value = q; run(q);
}

document.body.style.paddingBottom = "env(safe-area-inset-bottom)";
</script>
</body>
</html>
